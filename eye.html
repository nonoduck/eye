<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>çœ¼ç›èª¿ç¯€äº’å‹•æ¨¡æ“¬å™¨</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; width: 650px; }
        
        .vision-selector { margin-bottom: 20px; display: flex; justify-content: center; gap: 15px; }
        .mode-btn { padding: 8px 16px; border: 2px solid #ddd; border-radius: 20px; cursor: pointer; transition: 0.3s; }
        .mode-btn.active { background: #4a90e2; color: white; border-color: #4a90e2; }

        #canvas-container { position: relative; width: 600px; height: 300px; border: 1px solid #eee; margin: 10px 0; overflow: hidden; background: #fff; }
        
        #instruction { color: #888; font-size: 0.9rem; margin-top: 10px; }
        .status-box { margin-top: 15px; padding: 10px; background: #f9f9f9; border-radius: 10px; min-height: 50px; }
        
        /* è®“æ›¸æœ¬çœ‹èµ·ä¾†åƒå¯ä»¥æ‹–å‹• */
        #book-guide { color: #4a90e2; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>çœ¼ç›èª¿ç¯€ï¼šé è¿‘èˆ‡è¦–åŠ›æ¨¡æ“¬</h2>
    
    <div class="vision-selector">
        <div class="mode-btn active" onclick="setMode('normal', this)">è¦–åŠ›æ­£å¸¸</div>
        <div class="mode-btn" onclick="setMode('myopia', this)">è¿‘è¦– (çœ¼è»¸éé•·)</div>
        <div class="mode-btn" onclick="setMode('presbyopia', this)">è€èŠ± (æ°´æ™¶é«”ç¡¬åŒ–)</div>
    </div>

    <div id="canvas-container">
        <svg width="600" height="300" id="eyeSvg">
            <path id="retina" d="M 520 80 A 100 120 0 0 1 520 220" fill="none" stroke="#e74c3c" stroke-width="4" />
            <text x="530" y="70" fill="#e74c3c" font-size="12">è¦–ç¶²è†œ</text>

            <path id="light-rays" d="" fill="rgba(255, 222, 89, 0.3)" stroke="#ffde59" stroke-width="1" />

            <ellipse id="lens" cx="400" cy="150" rx="12" ry="45" fill="#add8e6" stroke="#5da9e9" stroke-width="2" />
            <text x="385" y="215" fill="#5da9e9" font-size="12">æ°´æ™¶é«”</text>

            <g id="book" style="cursor: grab;">
                <rect x="0" y="0" width="40" height="50" fill="#fff" stroke="#333" stroke-width="2" />
                <line x1="5" y1="10" x2="35" y2="10" stroke="#eee" />
                <line x1="5" y1="20" x2="35" y2="20" stroke="#eee" />
                <line x1="5" y1="30" x2="25" y2="30" stroke="#eee" />
                <text x="8" y="45" font-size="10" fill="#333">BOOK</text>
            </g>
        </svg>
    </div>

    <div class="status-box">
        <div id="status-desc">è«‹å·¦å³ç§»å‹•æ›¸æœ¬è§€å¯Ÿæ°´æ™¶é«”è®ŠåŒ–</div>
    </div>
    
    <div id="instruction">ğŸ’¡ é»æ“Šä¸¦å·¦å³æ‹–å‹•ã€Œæ›¸æœ¬ã€ä¾†æ”¹è®Šè·é›¢</div>
</div>

<script>
    const svg = document.getElementById('eyeSvg');
    const book = document.getElementById('book');
    const lens = document.getElementById('lens');
    const rays = document.getElementById('light-rays');
    const statusDesc = document.getElementById('status-desc');
    
    let currentMode = 'normal';
    let isDragging = false;
    let bookX = 100;

    // è¨­å®šåˆå§‹ä½ç½®
    updateVisuals(100);

    // æ‹–å‹•é‚è¼¯
    book.addEventListener('mousedown', () => isDragging = true);
    window.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        const rect = svg.getBoundingClientRect();
        let x = e.clientX - rect.left - 20;
        if (x < 20) x = 20;
        if (x > 330) x = 330;
        bookX = x;
        updateVisuals(bookX);
    });
    window.addEventListener('mouseup', () => isDragging = false);

    function setMode(mode, btn) {
        currentMode = mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        updateVisuals(bookX);
    }

    function updateVisuals(x) {
        // 1. ç§»å‹•æ›¸æœ¬
        book.setAttribute('transform', `translate(${x}, 125)`);

        // 2. è¨ˆç®—è·é›¢ (è¶Šå°ä»£è¡¨è¶Šè¿‘)
        const distance = 400 - x; 
        const distFactor = (380 - distance) / 300; // 0 (é ) åˆ° 1 (è¿‘)

        // 3. æ°´æ™¶é«”å½¢ç‹€è®ŠåŒ–
        let rx = 10;
        let ry = 45;

        if (currentMode === 'presbyopia') {
            // è€èŠ±çœ¼ï¼šè¿‘è·é›¢æ™‚æ°´æ™¶é«”è®Šåšå—é™
            rx = 10 + (distFactor * 8); 
            if(rx > 15) rx = 15; 
        } else {
            // æ­£å¸¸èˆ‡è¿‘è¦–ï¼šå¯ä»¥è®Šå¾ˆåš
            rx = 10 + (distFactor * 25);
            ry = 45 - (distFactor * 10);
        }
        
        lens.setAttribute('rx', rx);
        lens.setAttribute('ry', ry);

        // 4. è¨ˆç®—ç„¦é»ä½ç½® (Focus Point)
        let retinaX = 520; // è¦–ç¶²è†œä½ç½®
        let focusX = 520;  // é è¨­æº–ç¢ºèšç„¦

        if (currentMode === 'myopia') {
            // è¿‘è¦–ï¼šçœ¼è»¸å¤ªé•·ï¼Œæˆ–æ˜¯æŠ˜å°„å¤ªå¼·ï¼Œç„¦é»è½åœ¨è¦–ç¶²è†œå‰
            focusX = 480 + (distFactor * 20); 
        } else if (currentMode === 'presbyopia') {
            // è€èŠ±ï¼šçœ‹è¿‘æ™‚ï¼Œæ°´æ™¶é«”ä¸å¤ åšï¼Œç„¦é»è½åœ¨è¦–ç¶²è†œå¾Œ
            if (distance < 200) {
                focusX = 520 + ( (200 - distance) * 0.5 );
            }
        }

        // 5. æ›´æ–°å…‰ç·šè·¯å¾‘ (å¾æ›¸æœ¬åˆ°æ°´æ™¶é«”é‚Šç·£ï¼Œå†åˆ°ç„¦é»)
        const lensTop = 150 - ry;
        const lensBottom = 150 + ry;
        const bookRight = x + 40;
        const bookMidY = 150;
        
        const pathData = `M ${bookRight} ${bookMidY-10} L 400 ${lensTop} L ${focusX} 150 L 400 ${lensBottom} L ${bookRight} ${bookMidY+10} Z`;
        rays.setAttribute('d', pathData);

        // 6. æ¨¡ç³Šæ•ˆæœ (æ›¸æœ¬é¡è‰²è®Šæ·¡)
        // è¨ˆç®—ç„¦é»èˆ‡è¦–ç¶²è†œçš„å·®è·
        const blurGap = Math.abs(focusX - retinaX);
        const opacity = Math.max(0.1, 1 - (blurGap / 40));
        book.style.opacity = opacity;

        // 7. æ›´æ–°æ–‡å­—æè¿°
        updateStatus(distance, blurGap);
    }

    function updateStatus(dist, gap) {
        let text = "";
        if (gap < 5) {
            text = "âœ¨ <b>è¦–è¦ºæ¸…æ™°</b>ï¼šå…‰ç·šæº–ç¢ºèšç„¦åœ¨è¦–ç¶²è†œä¸Šã€‚";
        } else {
            text = "æ¨¡ç³Šï¼šå…‰ç·šæœªæº–ç¢ºèšç„¦ï¼Œæ›¸æœ¬å½±åƒè®Šæ·¡ã€‚";
            if (currentMode === 'myopia') text += " (è¿‘è¦–ï¼šç„¦é»åœ¨è¦–ç¶²è†œå‰)";
            if (currentMode === 'presbyopia') text += " (è€èŠ±ï¼šæ°´æ™¶é«”èª¿ç¯€åŠ›ä¸è¶³)";
        }
        statusDesc.innerHTML = text;
    }
</script>

</body>
</html>